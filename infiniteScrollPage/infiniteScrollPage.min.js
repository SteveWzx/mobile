/* infiniteScrollPage 2014-08-15
 * version: 0.1.0
 * @author: zhangchen2397@126.com
 */
!function(a,b){"function"==typeof define?define("infiniteScrollPage",["jqmobi"],function(c){return b(a,c)}):a.infiniteScrollPage=b(a,a.$)}(window,function(a,b){var c=function(a){this.defaultConfig={el:"#container",conListWrap:".con-list-wrap",autoLoading:".auto-loading",clickLoading:".click-loading",ajaxUrl:"./api.json",pagePara:"pn",maxAutoPage:5,offsetHeight:60,timeout:5e3,dataType:"text/html",curMod:null},this.config=b.extend(this.defaultConfig,a||{}),this.el="string"==typeof this.config.el?b(this.config.el):this.config.el,this.init.call(this)};return b.extend(c.prototype,{init:function(){this.canAutoAjaxData=!0,this.curPage=1,this.reTryNum=0,this._cacheDom(),this._initEvent(),this.ajaxData()},_cacheDom:function(){var a=this.config,b=this.el;this.conListWrap=b.find(a.conListWrap),this.autoLoading=b.find(a.autoLoading),this.clickLoading=b.find(a.clickLoading)},_initEvent:function(){var a=this.config,c=a.curMod;this.scrollCb=b.proxy(this._scrollCb,this),c?b.bind(c,"scroll",this.scrollCb):b(window).bind("scroll",this.scrollCb),this.clickLoading.bind("click",b.proxy(this._clickAjaxData,this))},_clickAjaxData:function(){this.autoLoading.show(),this.clickLoading.hide(),this.ajaxData()},_scrollCb:function(){var a=this,c=this.config;document.body.scrollTop+b(window).height()>b("body").height()-c.offsetHeight&&a.canAutoAjaxData&&(a.canAutoAjaxData=!1,a.ajaxData())},ajaxData:function(){var a=this.config,c=this,d=a.curMod,e=a.ajaxUrl,f="?";a.ajaxUrl.indexOf("?")>-1&&(f="&"),e+=f+a.pagePara+"="+this.curPage+"&ver="+ +new Date,"jsonp"==a.dataType&&(e+="&callback=?"),b.ajax({url:e,timeout:a.timeout,dataType:a.dataType,success:function(e){b.trigger(c,"ajaxSuccess",[{data:e}]),c.autoLoading.hide(),c.curPage++,c.reTryNum=0,c.curPage>a.maxAutoPage?(c.clickLoading.show(),c.canAutoAjaxData=!1,d?b.unbind(d,"scroll",this.scrollCb):b(window).unbind("scroll",this.scrollCb)):(c.canAutoAjaxData=!0,c.autoLoading.show())},error:function(){c.reTryNum++,c.reTryNum<3?c.ajaxData():b.trigger(c,"ajaxFinalError"),b.trigger(c,"ajaxError")}})}}),{infiniteScrollPage:c,createInfinteScrollPage:function(a){return new c(a)}}});